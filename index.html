<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>DT Union Â· ç¤¾å›¢é—¨æˆ·</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
  <style>
    .page{display:none}
    .glass{backdrop-filter:saturate(140%) blur(8px); background:rgba(255,255,255,.65)}
    .hero{background:url('https://images.unsplash.com/photo-1521412644187-c49fa049e84d?auto=format&fit=crop&w=1600&q=80') center/cover no-repeat}
    .card{transition:transform .2s ease, box-shadow .2s ease}
    .card:hover{transform:translateY(-2px); box-shadow:0 12px 25px rgba(0,0,0,.08)}
  </style>
</head>
<body class="bg-slate-50 text-slate-900">

<!-- é¡¶éƒ¨å¯¼èˆª -->
<nav class="sticky top-0 z-50 bg-white/80 backdrop-blur border-b border-slate-200">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
    <div class="font-black text-2xl tracking-wide">DT Union</div>
    <div class="hidden md:flex items-center gap-6 text-sm">
      <a href="#" onclick="go('home')" class="hover:text-blue-700">ä¸»é¡µ</a>
      <a href="#" onclick="go('about')" class="hover:text-blue-700">å…³äºDTU</a>
      <a href="#" onclick="go('logic')" class="hover:text-blue-700">æ¨ç†ä¿±ä¹éƒ¨</a>
      <a href="#" onclick="go('soccer')" class="hover:text-blue-700">è¶³çƒä¿±ä¹éƒ¨</a>
      <a href="#" onclick="go('fitness')" class="hover:text-blue-700">å¥èº«æ‰“å¡</a>
      <a href="#" onclick="go('auth')" class="hover:text-blue-700">ç™»å½•/æ³¨å†Œ</a>
      <span id="adminMenu" class="hidden">
        <a href="#" onclick="go('admin')" class="text-amber-700 font-semibold">åå°</a>
      </span>
    </div>
    <div id="statusBar" class="text-xs sm:text-sm italic">å½“å‰æœªç™»å½•</div>
  </div>
</nav>

<!-- ä¸»é¡µ -->
<section id="home" class="page block">
  <div class="hero">
    <div class="max-w-5xl mx-auto px-6 py-20">
      <div class="glass rounded-2xl p-8 shadow-lg">
        <h1 class="text-4xl md:text-5xl font-black tracking-tight">æ¬¢è¿æ¥åˆ° DT Union</h1>
        <p class="mt-3 text-slate-700 text-lg">æ¨ç† Â· è¶³çƒ Â· å¥èº« â€”â€” ä¸€ä¸ªæ±‡èšæ€è€ƒä¸æ±—æ°´çš„ç¤¾åŒºã€‚</p>
        <div class="mt-6 flex gap-3">
          <button onclick="go('auth')" class="bg-blue-700 hover:bg-blue-800 text-white px-5 py-2 rounded-xl">ç«‹å³åŠ å…¥</button>
          <button onclick="go('logic')" class="bg-white hover:bg-slate-100 border px-5 py-2 rounded-xl">çœ‹çœ‹é¢˜åº“</button>
        </div>
      </div>
    </div>
  </div>

  <!-- å…¬å‘Šæ  -->
  <div class="max-w-4xl mx-auto px-6 py-10">
    <h2 class="text-2xl font-bold mb-4">ğŸ“¢ å…¬å‘Šæ </h2>
    <div id="announcementBox" class="space-y-3"></div>
  </div>

  <!-- ä¸‰ä¸ªä¿±ä¹éƒ¨å¡ç‰‡ -->
  <div class="max-w-6xl mx-auto px-6 py-12 grid md:grid-cols-3 gap-6">
    <div class="card bg-white rounded-2xl p-6 shadow">
      <h3 class="text-xl font-bold mb-2">æ¨ç†ä¿±ä¹éƒ¨</h3>
      <p class="text-slate-600">å‘å¸ƒè°œé¢˜ï¼Œåˆ†äº«æ€è·¯ï¼Œå’ŒåŒå¥½è®¨è®ºæœ€ä¼˜è§£ã€‚</p>
      <button onclick="go('logic')" class="mt-4 text-blue-700 hover:underline">è¿›å…¥é¢˜åº“ â†’</button>
    </div>
    <div class="card bg-white rounded-2xl p-6 shadow">
      <h3 class="text-xl font-bold mb-2">è¶³çƒä¿±ä¹éƒ¨</h3>
      <p class="text-slate-600">å‹è°Šèµ›ã€è§‚èµ›ã€æˆ˜æœ¯å¤ç›˜ï¼Œçƒåœºé‡Œå¤–å°½æƒ…èŠã€‚</p>
      <button onclick="go('soccer')" class="mt-4 text-blue-700 hover:underline">æŸ¥çœ‹è¯¦æƒ… â†’</button>
    </div>
    <div class="card bg-white rounded-2xl p-6 shadow">
      <h3 class="text-xl font-bold mb-2">å¥èº«æ‰“å¡</h3>
      <p class="text-slate-600">è®°å½•è®­ç»ƒä¸é¥®é£Ÿï¼Œäº’ç›¸é¼“åŠ±ï¼Œè§è¯èœ•å˜ã€‚</p>
      <button onclick="go('fitness')" class="mt-4 text-blue-700 hover:underline">å¼€å§‹æ‰“å¡ â†’</button>
    </div>
  </div>
</section>

<!-- ç™»å½•/æ³¨å†Œ -->
<section id="auth" class="page max-w-md mx-auto p-6">
  <h2 class="text-2xl font-bold mb-4">ç™»å½• / æ³¨å†Œ</h2>
  <div class="grid gap-2">
    <input id="email" placeholder="é‚®ç®±" class="border p-2 rounded">
    <input id="password" type="password" placeholder="å¯†ç " class="border p-2 rounded">
    <div class="flex gap-2">
      <button onclick="register()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded">æ³¨å†Œ</button>
      <button onclick="login()" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded">ç™»å½•</button>
      <button onclick="logout()" class="bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded">é€€å‡º</button>
    </div>
    <p class="text-xs text-slate-500">æ³¨å†Œåéœ€ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡æ‰èƒ½å‘å¸–/è¯„è®ºã€‚</p>
  </div>
</section>
<!-- æ¨ç†ä¿±ä¹éƒ¨ -->
<section id="logic" class="page max-w-5xl mx-auto p-6">
  <div class="flex items-center justify-between">
    <h2 class="text-3xl font-bold">æ¨ç†ä¿±ä¹éƒ¨ Â· é¢˜åº“</h2>
  </div>

  <!-- å‘å¸–æ¡† -->
  <div class="mt-4 max-w-2xl">
    <input id="logicTitle" placeholder="é¢˜ç›®æ ‡é¢˜" class="border p-2 rounded w-full mb-2">
    <textarea id="logicContent" placeholder="é¢˜ç›®å†…å®¹ï¼ˆä¸éœ€è¦å†™ç­”æ¡ˆï¼‰" class="border p-2 rounded w-full mb-2"></textarea>
    <button onclick="addPost('logic')" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded">å‘å¸ƒé¢˜ç›®</button>
    <p class="text-xs text-slate-500 mt-1">* ä»…å®¡æ ¸é€šè¿‡çš„ç”¨æˆ·å¯å‘å¸–ä¸è¯„è®º</p>
  </div>

  <!-- å¸–å­åˆ—è¡¨ -->
  <div id="posts-logic" class="mt-6 grid gap-4"></div>
</section>

<!-- è¶³çƒä¿±ä¹éƒ¨ï¼ˆä»‹ç»ä¸ºä¸»ï¼‰ -->
<section id="soccer" class="page max-w-5xl mx-auto p-6">
  <h2 class="text-3xl font-bold">è¶³çƒä¿±ä¹éƒ¨</h2>
  <div class="mt-4 space-y-3 text-slate-700">
    <p>æˆ‘ä»¬å®šæœŸç»„ç»‡å‹è°Šèµ›ä¸è®­ç»ƒè¯¾ï¼›ä¹Ÿä¼šä¸€èµ·è§‚èµ›ã€å¤ç›˜æˆ˜æœ¯ï¼Œæ¬¢è¿é›¶åŸºç¡€åŒå­¦åŠ å…¥ã€‚</p>
    <ul class="list-disc list-inside">
      <li>æ¯å‘¨æœ«æ ¡å›­çƒåœºå‹è°Šèµ›</li>
      <li>æˆ˜æœ¯è¯¾å ‚ä¸å½•åƒå¤ç›˜</li>
      <li>è£…å¤‡/ä½ç½®/è·‘ä½å…¥é—¨åˆ†äº«</li>
    </ul>
  </div>
</section>

<!-- å¥èº«æ‰“å¡ï¼ˆè®ºå›æ¨¡å¼ï¼‰ -->
<section id="fitness" class="page max-w-5xl mx-auto p-6">
  <div class="flex items-center justify-between">
    <h2 class="text-3xl font-bold">å¥èº«æ‰“å¡ Â· è®ºå›</h2>
  </div>

  <!-- å‘å¸–æ¡† -->
  <div class="mt-4 max-w-2xl">
    <input id="fitTitle" placeholder="æ‰“å¡ä¸»é¢˜" class="border p-2 rounded w-full mb-2">
    <textarea id="fitContent" placeholder="ä»Šå¤©è®­ç»ƒäº†ä»€ä¹ˆï¼Ÿé¥®é£Ÿå¦‚ä½•ï¼Ÿ" class="border p-2 rounded w-full mb-2"></textarea>
    <button onclick="addPost('fitness')" class="bg-emerald-700 hover:bg-emerald-800 text-white px-4 py-2 rounded">å‘å¸ƒæ‰“å¡</button>
    <p class="text-xs text-slate-500 mt-1">* ä»…å®¡æ ¸é€šè¿‡çš„ç”¨æˆ·å¯å‘å¸–ä¸è¯„è®º</p>
  </div>

  <!-- å¸–å­åˆ—è¡¨ -->
  <div id="posts-fitness" class="mt-6 grid gap-4"></div>
</section>
<!-- ç®¡ç†å‘˜åå° -->
<section id="admin" class="page max-w-5xl mx-auto p-6">
  <h2 class="text-2xl font-bold">ç®¡ç†å‘˜åå°</h2>
  <div class="mt-6 grid md:grid-cols-2 gap-8">
    <div>
      <h3 class="font-semibold">å¾…å®¡æ ¸ç”¨æˆ·</h3>
      <div id="pendingUsers" class="mt-2"></div>
    </div>
    <div>
      <h3 class="font-semibold">å·²é€šè¿‡ç”¨æˆ·</h3>
      <div id="approvedUsers" class="mt-2"></div>
    </div>
  </div>

  <div class="mt-10">
    <h3 class="font-semibold mb-2">å…¬å‘Šç®¡ç†</h3>
    <textarea id="newAnnouncement" placeholder="è¾“å…¥å…¬å‘Šå†…å®¹..." class="border p-2 rounded w-full mb-2"></textarea>
    <button onclick="addAnnouncement()" class="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded">å‘å¸ƒå…¬å‘Š</button>
    <div id="announcementManage" class="mt-4 space-y-2"></div>
  </div>
</section>

<!-- å…³äº DTU -->
<section id="about" class="page max-w-5xl mx-auto p-6">
  <h2 class="text-3xl font-bold mb-4">å…³äº DTU</h2>

  <!-- ç¤¾å›¢ä»‹ç» -->
  <div class="mb-6">
    <p class="text-slate-700 leading-relaxed">
      DT Union æˆç«‹äº 2024 å¹´ä¼¦æ•¦å®‰å¤§ç•¥ï¼Œä»¥â€œDiverse Talentâ€ä¸ºç²¾ç¥ï¼Œæ—¨åœ¨è®©å­¦ç”Ÿèšåœ¨ä¸€èµ·ï¼Œæ¢ç´¢å…´è¶£ã€å‘æŒ¥æ‰èƒ½å¹¶äº’ç›¸æ”¯æŒã€‚
      ç°æœ‰æ¨ç†ã€è¶³çƒã€å¥èº«ä¸‰å¤§ç¤¾å›¢ï¼Œå¸å¼•äº†æ¥è‡ªè‹±å›½ã€åŠ æ‹¿å¤§ã€ä¸­å›½ç­‰åœ°çš„æˆå‘˜ã€‚
    </p>
  </div>

  <!-- æ–‡åŒ–ï¼ˆä¸­è‹±æ–‡åˆ‡æ¢ï¼‰ -->
  <div class="mb-6">
    <div class="flex items-center justify-between">
      <h3 class="text-xl font-semibold">æ–‡åŒ–</h3>
      <button onclick="toggleCultureLang()" class="text-sm text-blue-700 hover:underline">åˆ‡æ¢è¯­è¨€</button>
    </div>
    <p id="cultureText" class="mt-2 text-slate-700 leading-relaxed">
      We are excited to introduce DT Union to the community!  
      Founded in 2024 in London, Ontario, DT Union began with a simple vision: to create a space where students could come together, explore their passions, and support each otherâ€™s growth.  
      ...ï¼ˆè‹±æ–‡å†…å®¹çœç•¥ï¼Œå®Œæ•´è§ä¹‹å‰æ–‡æœ¬ï¼‰
    </p>
  </div>

  <!-- ç»„ç»‡æ²»ç†æ¶æ„ -->
  <div>
    <h3 class="text-xl font-semibold mb-2">ç»„ç»‡æ²»ç†æ¶æ„</h3>
    <p class="text-slate-700 mb-4">DT Union çš„æ²»ç†æ¶æ„å¼ºè°ƒé€æ˜ã€åˆä½œä¸é«˜æ•ˆã€‚ä»¥ä¸‹ä¸ºæˆ‘ä»¬çš„æ­£å¼ç»„ç»‡ç»“æ„å›¾ï¼š</p>
    <div class="flex justify-center">
      <img src="assets/dtu-structure.png" alt="DTU ç»„ç»‡æ²»ç†æ¶æ„" class="rounded-lg shadow-lg max-w-full h-auto">
    </div>
  </div>
</section>

<!-- ================== è„šæœ¬ ================== -->
<script>
const SUPABASE_URL = "https://pagpdgzuvikpdbjupqql.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBhZ3BkZ3p1dmlrcGRianVwcXFsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyNDQyNzgsImV4cCI6MjA3MzgyMDI3OH0.t7OuWP_leNs74XmXVH2ilg21PqetYEk7NJjPwiF_1lY";
let sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
let currentUser = null;

const $ = id => document.getElementById(id);
function go(id) {
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
  $(id).style.display = 'block';
  if (id === 'logic') renderPosts('logic');
  if (id === 'fitness') renderPosts('fitness');
  if (id === 'admin') renderUsers(), renderAnnouncements();
  renderNav();
}
function renderNav() {
  if (currentUser) $('statusBar').textContent = `å½“å‰ç”¨æˆ·ï¼š${currentUser.nickname || currentUser.email}${currentUser.is_admin ? 'ï¼ˆç®¡ç†å‘˜ï¼‰':''}`;
  else $('statusBar').textContent = 'å½“å‰æœªç™»å½•';
  $('adminMenu').classList.toggle('hidden', !(currentUser && currentUser.is_admin));
}

// æ³¨å†Œ
async function register() {
  const email = $('email').value.trim();
  const pass = $('password').value;
  if (!email || !pass) return alert("è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ");
  const { error } = await sb.auth.signUp({ email, password: pass });
  if (error) return alert(error.message);
  alert("æ³¨å†ŒæˆåŠŸï¼Œè¯·ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ã€‚");
}

// ç™»å½•
async function login() {
  const email = $('email').value.trim();
  const pass = $('password').value;
  const { error } = await sb.auth.signInWithPassword({ email, password: pass });
  if (error) return alert(error.message);
  const { data: { user } } = await sb.auth.getUser();
  const { data: prof } = await sb.from('profiles').select('*').eq('id', user.id).maybeSingle();
  if (!prof?.approved) return alert("ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ä¸­");
  currentUser = { id: user.id, email: user.email, is_admin: prof.is_admin, nickname: prof.nickname };
  renderNav(); go('home');
}
async function logout(){ await sb.auth.signOut(); currentUser=null; renderNav(); go('home'); }

// æ¸²æŸ“ç”¨æˆ·ï¼ˆå®¡æ ¸/ç¦è¨€ï¼‰
async function renderUsers(){
  const { data } = await sb.from('profiles').select('id,email,is_admin,approved,muted').order('email');
  const pending=$('pendingUsers'), approved=$('approvedUsers');
  pending.innerHTML=''; approved.innerHTML='';
  data.forEach(u=>{
    const div=document.createElement('div');
    div.className="p-2 border rounded bg-white flex justify-between items-center";
    if(!u.approved){
      div.innerHTML=`<span>${u.email}</span>
        <button class="bg-emerald-600 text-white px-2 py-1 rounded" onclick="approveUser('${u.id}')">é€šè¿‡</button>
        <button class="bg-rose-600 text-white px-2 py-1 rounded" onclick="removeUser('${u.id}')">æ‹’ç»</button>`;
      pending.appendChild(div);
    } else {
      div.innerHTML=`<span>${u.email}${u.is_admin?'ï¼ˆç®¡ç†å‘˜ï¼‰':''}${u.muted?'ï¼ˆç¦è¨€ï¼‰':''}</span>
        ${!u.is_admin?`<button class="bg-slate-600 text-white px-2 py-1 rounded" onclick="toggleMute('${u.id}',${u.muted})">${u.muted?'è§£ç¦':'ç¦è¨€'}</button>`:''}`;
      approved.appendChild(div);
    }
  });
}
async function approveUser(uid){await sb.from('profiles').update({approved:true}).eq('id',uid);renderUsers();}
async function removeUser(uid){await sb.from('profiles').delete().eq('id',uid);renderUsers();}
async function toggleMute(uid,cur){await sb.from('profiles').update({muted:!cur}).eq('id',uid);renderUsers();}

// å¸–å­+è¯„è®ºï¼ˆç®€åŒ–å¸¦æŠ˜å ï¼‰
async function addPost(type){
  const title=$(type==='logic'?'logicTitle':'fitTitle').value.trim();
  const content=$(type==='logic'?'logicContent':'fitContent').value.trim();
  if(!currentUser) return alert("è¯·å…ˆç™»å½•");
  if(!title||!content) return alert("è¯·è¾“å…¥å†…å®¹");
  await sb.from('posts').insert({type,title,content,author_id:currentUser.id,author_email:currentUser.email});
  renderPosts(type);
}
async function addComment(postId,type){
  if(!currentUser) return alert("è¯·å…ˆç™»å½•");
  const body=$(`cmt-${postId}`).value.trim();
  if(!body) return;
  await sb.from('comments').insert({post_id:postId,body,author_id:currentUser.id,author_email:currentUser.email});
  renderPosts(type);
}
async function renderPosts(type){
  const box=$(`posts-${type}`); box.innerHTML='';
  const { data:list }=await sb.from('posts').select('id,title,content,author_email,created_at').eq('type',type).order('id',{ascending:false});
  for(const p of list||[]){
    const { data:cmts }=await sb.from('comments').select('*').eq('post_id',p.id).order('id',{ascending:true});
    box.appendChild(renderPostCard(p,cmts||[]));
  }
}
function renderPostCard(p,comments){
  const card=document.createElement('div'); card.className="bg-white rounded-2xl shadow p-5";
  const ts=new Date(p.created_at).toLocaleString();
  card.innerHTML=`
    <h3 class="text-xl font-bold">${escapeHtml(p.title)}</h3>
    <p class="mt-2 text-slate-700 whitespace-pre-wrap line-clamp-3" id="content-${p.id}">${escapeHtml(p.content)}</p>
    <button class="text-blue-600 text-sm mt-1" onclick="togglePost(${p.id})">å±•å¼€/æ”¶èµ·</button>
    <div class="text-xs text-slate-500 mt-2">ä½œè€…ï¼š${escapeHtml(p.author_email)} Â· æ—¶é—´ï¼š${ts}</div>
    <div class="mt-3 flex items-center gap-2">
      <input id="cmt-${p.id}" placeholder="å†™è¯„è®ºâ€¦" class="border p-2 rounded w-2/3">
      <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded" onclick="addComment(${p.id}, '${p.type}')">å›å¤</button>
    </div>
    <div id="cmts-${p.id}" class="mt-2 hidden space-y-1">
      ${(comments||[]).map(c=>`<div class="text-sm text-slate-800">ğŸ’¬ ${escapeHtml(c.author_email)}ï¼š${escapeHtml(c.body)}</div>`).join('')}
    </div>
    <button class="text-blue-600 text-sm mt-1" onclick="expandComments(${p.id})">å±•å¼€/æ”¶èµ·è¯„è®º</button>`;
  return card;
}
function togglePost(pid){const el=$(`content-${pid}`);el.classList.toggle("line-clamp-3");}
function expandComments(pid){$(`cmts-${pid}`).classList.toggle("hidden");}
function escapeHtml(s){return (s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[m]));}

// å…¬å‘Š
async function addAnnouncement(){
  const txt=$('newAnnouncement').value.trim();
  if(!txt) return;
  await sb.from('announcements').insert({content:txt,author:currentUser.email});
  $('newAnnouncement').value=''; renderAnnouncements();
}
async function renderAnnouncements(){
  const { data:list }=await sb.from('announcements').select('*').order('id',{ascending:false});
  const box=$('announcementBox'); box.innerHTML='';
  const manage=$('announcementManage'); manage.innerHTML='';
  (list||[]).forEach(a=>{
    const div=document.createElement('div');
    div.className="p-3 bg-white rounded shadow";
    div.textContent=`${a.content} â€”â€” ${a.author}`;
    box.appendChild(div);
    const m=document.createElement('div');
    m.className="p-2 border rounded flex justify-between items-center";
    m.innerHTML=`<span>${a.content}</span>
      <button class="text-red-600" onclick="deleteAnnouncement(${a.id})">åˆ é™¤</button>`;
    manage.appendChild(m);
  });
}
async function deleteAnnouncement(id){await sb.from('announcements').delete().eq('id',id);renderAnnouncements();}

// æ–‡åŒ–åˆ‡æ¢
let cultureLang='en';
function toggleCultureLang(){
  const en=`We are excited to introduce DT Union to the community!...`; // è‹±æ–‡å®Œæ•´æ–‡æœ¬
  const zh=`æˆ‘ä»¬å¾ˆé«˜å…´å‘å¤§å®¶ä»‹ç» DT Union!...`; // ä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬
  $('cultureText').textContent = cultureLang==='en'? zh: en;
  cultureLang=cultureLang==='en'?'zh':'en';
}

// å¯åŠ¨
(async function bootstrap(){
  const { data:{session} }=await sb.auth.getSession();
  if(session?.user){
    const { data:prof }=await sb.from('profiles').select('*').eq('id',session.user.id).maybeSingle();
    currentUser={ id:session.user.id, email:session.user.email, is_admin:prof?.is_admin, nickname:prof?.nickname };
  }
  renderNav(); go('home');
})();
</script>
</body>
</html>










